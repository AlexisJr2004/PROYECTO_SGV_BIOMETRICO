{% extends 'components/base.html' %}
{% block content %}
  {% load i18n %} <!-- Escencial para poder traducir la paguina -->
  {% load static %}
  <title>
    {% block title %}
      {{ title }}
    {% endblock %}
  </title>
  <section class="dark:bg-principal mt-20">
    <div class="text-center" data-aos="fade" data-aos-delay="200">
      <div class="sm:pt-28 lg:pt-4">
        <h1 class="dark:text-white text-4xl text-center mt-6 font-Pacifico">{{ title }}</h1>
      </div>
      <form method="post" enctype="multipart/form-data" class="space-y-6 py-4">
        <!-- Cabecera -->
        <style>
          .form-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
          }
          .form-row > div {
            flex: 1;
            min-width: 200px;
          }
        </style>
        <p class="text-gray-400 dark:text-gray-300 font-Pacifico">
          {% trans 'Nuevo registro de venta:' %} <span class="font-black text-2xl text-blue-400">001</span>
        </p>
        <div class="grid gap-8 mx-10 lg:mx-20" data-aos="fade">
          <div class="bg-gray-50 dark:bg-secundario rounded-3xl p-8" data-aos="fade-right" data-aos-delay="200">
            <form method="POST">
              {% csrf_token %}
              <div class="form-row">
                <div>
                  <label for="{{ form.customer.id_for_label }}" class="dark:text-blue-300 font-black uppercase text-sm">{{ form.customer.label }}</label>
                  {{ form.customer }}
                </div>
                <div>
                  <label for="{{ form.issue_date.id_for_label }}" class="dark:text-blue-300 font-black uppercase text-sm">{{ form.issue_date.label }}</label>
                  <input type="date" id="{{ form.issue_date.id_for_label }}" name="{{ form.issue_date.name }}" class="w-full p-2 rounded-md dark:bg-gray-700 dark:text-white" value="{{ form.issue_date.value|date:'Y-m-d' }}" />
                </div>
                <div>
                  <label for="issue_hora" class="dark:text-blue-300 font-black uppercase text-sm">Hora</label>
                  <input type="text" id="issue_hora" name="issue_hora" class="w-full p-2 rounded-md dark:bg-gray-700 dark:text-white" readonly />
                </div>
                <div>
                  <label for="{{ form.payment_method.id_for_label }}" class="dark:text-blue-300 font-black uppercase text-sm">{{ form.payment_method.label }}</label>
                  {{ form.payment_method }}
                </div>
                <div>
                  <label for="{{ form.state.id_for_label }}" class="dark:text-blue-300 font-black uppercase text-sm">{{ form.state.label }}</label>
                  {{ form.state }}
                </div>
              </div>
              <button type="submit" class="mt-4 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">{% trans 'Guardar' %}</button>
            </form>
          </div>
        </div>
        <p class="text-gray-400 dark:text-gray-300 font-Pacifico">
          {% trans 'Detalle de factura:' %}
        </p>
        <!-- Detalle -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
          <div class="col-span-2 mx-6 lg:mx-8 p-4 rounded-3xl dark:bg-secundario bg-gray-50 flex flex-col justify-center items-center">
            {{ detail_formset.management_form }}
            {% for form in detail_formset %}
              <div class="mb-8 grid grid-cols-2 lg:grid-cols-4 gap-6 justify-center items-center">
                <div class="mb-8 flex justify-between items-center">
                  <label for="{{ form.product.id_for_label }}" class="dark:text-blue-300 font-black uppercase text-lg pr-2">{{ form.product.label }}</label>
                  {{ form.product }}
                </div>
                <div class="mb-8 flex justify-between items-center">
                  <label for="{{ form.quantity.id_for_label }}" class="dark:text-blue-300 font-black uppercase text-lg pr-2">{{ form.quantity.label }}</label>
                  <div class="relative">
                    <span class="absolute inset-y-0 left-2 pr-3 flex items-center text-gray-400"><i class="fa-solid fa-boxes-stacked"></i></span>
                    {{ form.quantity }}
                  </div>
                </div>
                <div class="mb-8 flex justify-between items-center">
                  <label for="{{ form.price.id_for_label }}" class="dark:text-blue-300 font-black uppercase text-lg pr-2">{{ form.price.label }}</label>
                  <div class="relative">
                    <span class="absolute inset-y-0 left-2 pr-3 flex items-center text-gray-400"><i class="fa-solid fa-dollar-sign"></i></span>
                    {{ form.price }}
                  </div>
                </div>
                <div class="mb-8 flex justify-between items-center">
                  <a class="bg-gray-200 dark:bg-principal inline-flex items-center justify-center px-5 py-3 text-center rounded-lg hover:bg-gray-400 focus:ring-4 focus:ring-gray-100 dark:hover:bg-gray-700 dark:text-gray-400 dark:focus:ring-black cursor-pointer"><i class="fa-solid fa-box pr-4"></i><i class="fa-solid fa-plus"></i></a>
                </div>
              </div>
            {% endfor %}
            <div class="w-full overflow-x-auto">
              <table class="min-w-full text-center text-lg">
                <thead class="uppercase font-Tiny5 bg-gray-200 dark:bg-secundario dark:text-blue-300">
                  <tr>
                    <th scope="col" class="px-6 py-3">
                      {% trans 'PRODUCTO' %}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {% trans 'PRECIO' %}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {% trans 'CANTIDAD' %}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {% trans 'IVA' %}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {% trans 'SUBTOTAL' %}
                    </th>
                    <th scope="col" class="px-6 py-3">
                      {% trans 'ACCIONES' %}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="dark:text-gray-400 bg-white border-b dark:bg-[#0b1121] dark:border-secundario hover:bg-gray-50 dark:hover:bg-[#121c33]">
                    <td class="px-6 py-4">Coca Cola</td>
                    <td class="px-6 py-4">1</td>
                    <td class="px-6 py-4">12</td>
                    <td class="px-6 py-4">12%</td>
                    <td class="px-6 py-4">-</td>
                    <td class="px-6 py-4">
                      <a href="#" class="text-blue-600 dark:text-blue-500"><i class="fa-solid fa-pen"></i></a>
                      <a href="#" class="text-red-600 dark:text-red-500"><i class="fa-solid fa-trash"></i></a>
                    </td>
                  </tr>
                  <tr class="dark:text-gray-400 bg-white border-b dark:bg-[#0b1121] dark:border-secundario hover:bg-gray-50 dark:hover:bg-[#121c33]">
                    <td class="px-6 py-4">Ruffles</td>
                    <td class="px-6 py-4">1.25</td>
                    <td class="px-6 py-4">13</td>
                    <td class="px-6 py-4">12%</td>
                    <td class="px-6 py-4">-</td>
                    <td class="px-6 py-4">
                      <a href="#" class="text-blue-600 dark:text-blue-500"><i class="fa-solid fa-pen"></i></a>
                      <a href="#" class="text-red-600 dark:text-red-500"><i class="fa-solid fa-trash"></i></a>
                    </td>
                  </tr>
                  <tr class="dark:text-gray-400 bg-white border-b dark:bg-[#0b1121] dark:border-secundario hover:bg-gray-50 dark:hover:bg-[#121c33]">
                    <td class="px-6 py-4">Calculadora</td>
                    <td class="px-6 py-4">20</td>
                    <td class="px-6 py-4">1</td>
                    <td class="px-6 py-4">12%</td>
                    <td class="px-6 py-4">-</td>
                    <td class="px-6 py-4">
                      <a href="#" class="text-blue-600 dark:text-blue-500"><i class="fa-solid fa-pen"></i></a>
                      <a href="#" class="text-red-600 dark:text-red-500"><i class="fa-solid fa-trash"></i></a>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="mx-10 lg:mx-2 col-span-1 p-4 rounded-3xl dark:bg-secundario bg-gray-50 flex flex-col justify-center items-center">
            <div class="mb-2 w-full">
              <div class="mb-2 flex justify-between items-center">
                <label for="{{ form.iva.id_for_label }}" class="dark:text-blue-300 font-black uppercase text-lg w-32 pr-28">{{ form.iva.label }}</label>
                {{ form.iva }}
              </div>
              <div class="mb-2 flex justify-between items-center">
                <label for="{{ form.discount.id_for_label }}" class="dark:text-blue-300 font-black uppercase text-lg w-32 pr-28">{{ form.discount.label }}</label>
                {{ form.discount }}
              </div>
              <div class="mb-2 flex justify-between items-center">
                <label for="{{ form.subtotal.id_for_label }}" class="dark:text-blue-300 font-black uppercase text-lg w-32 pr-28">{{ form.subtotal.label }}</label>
                {{ form.subtotal }}
              </div>
              <div class="mb-2 flex justify-between items-center">
                <label for="{{ form.total.id_for_label }}" class="dark:text-blue-300 font-black uppercase text-lg w-32 pr-28">{{ form.total.label }}</label>
                {{ form.total }}
              </div>
            </div>
          </div>
        </div>
        <!-- Pie -->
        <div class="mx-10 lg:mx-64 p-4 rounded-3xl dark:bg-secundario bg-gray-50 flex flex-col justify-center items-center">
          <div class="mb-8 grid grid-cols-2 gap-8 justify-center items-center">
            <div class="mb-8">
              <label for="{{ form.payment.id_for_label }}" class="dark:text-blue-300 font-black uppercase text-lg">{{ form.payment.label }}</label>
              <div class="relative">
                <span class="absolute inset-y-0 left-2 pr-3 flex items-center text-gray-400"><i class="fa-solid fa-comments-dollar"></i></span>
                {{ form.payment }}
              </div>
            </div>
            <div class="mb-8">
              <label for="{{ form.change.id_for_label }}" class="dark:text-blue-300 font-black uppercase text-lg">{{ form.change.label }}</label>
              <div class="relative">
                <span class="absolute inset-y-0 left-2 pr-3 flex items-center text-gray-400"><i class="fa-solid fa-money-bill-transfer"></i></span>
                {{ form.change }}
              </div>
            </div>
          </div>
          <label for="{{ form.active.id_for_label }}" class="dark:text-blue-300 font-black uppercase text-lg">{{ form.active.label }}</label>
          {{ form.active }}
        </div>
        <br />
        <div class="flex flex-col md:flex-row justify-center mt-6 px-4 md:px-0">
          <button type="submit" class="bg-blue-700 hover:bg-blue-800 text-white py-2 px-4 rounded-full mb-2 md:mr-2 md:mb-0 flex items-center justify-center w-full md:w-auto"><i class="fa-solid fa-save mr-2"></i>{% trans 'Guardar' %}</button>
          <a class="bg-red-700 hover:bg-red-800 text-white py-2 px-4 rounded-full flex items-center justify-center w-full md:w-auto" href="{% url 'home' %}"><i class="fa-solid fa-xmark mr-2"></i>{% trans 'Cancelar' %}</a>
        </div>
      </form>
    </div>
  </section>

  <script>
    function actualizarHora() {
      var ahora = new Date()
      var horas = ahora.getHours().toString().padStart(2, '0')
      var minutos = ahora.getMinutes().toString().padStart(2, '0')
      var segundos = ahora.getSeconds().toString().padStart(2, '0')
      document.getElementById('issue_hora').value = horas + ':' + minutos + ':' + segundos
    }
    
    // Actualizar la hora inmediatamente y luego cada segundo
    actualizarHora()
    setInterval(actualizarHora, 1000)
  </script>
{% endblock %}
